-- إصلاح مشكلة Function Search Path Mutable للدوال الأمنية

-- تحديث جميع الدوال لتتضمن search_path = 'public' لضمان الأمان
ALTER FUNCTION public.update_store_settings_updated_at() SET search_path = 'public';
ALTER FUNCTION public.generate_movement_number() SET search_path = 'public';
ALTER FUNCTION public.generate_return_number() SET search_path = 'public';
ALTER FUNCTION public.set_movement_number() SET search_path = 'public';
ALTER FUNCTION public.set_return_number() SET search_path = 'public';
ALTER FUNCTION public.calculate_invoice_totals() SET search_path = 'public';
ALTER FUNCTION public.update_updated_at_timestamp() SET search_path = 'public';
ALTER FUNCTION public.generate_invoice_number() SET search_path = 'public';
ALTER FUNCTION public.generate_refund_number() SET search_path = 'public';
ALTER FUNCTION public.set_invoice_number() SET search_path = 'public';
ALTER FUNCTION public.set_refund_number() SET search_path = 'public';
ALTER FUNCTION public.update_last_activity() SET search_path = 'public';
ALTER FUNCTION public.create_user_shop(uuid, text, text) SET search_path = 'public';
ALTER FUNCTION public.update_user_role(text, user_role) SET search_path = 'public';
ALTER FUNCTION public.create_affiliate_store(text, text, text) SET search_path = 'public';
ALTER FUNCTION public.prevent_role_escalation() SET search_path = 'public';
ALTER FUNCTION public.handle_new_user() SET search_path = 'public';
ALTER FUNCTION public.generate_shipment_number() SET search_path = 'public';
ALTER FUNCTION public.set_shipment_number() SET search_path = 'public';
ALTER FUNCTION public.get_channel_member_count(uuid) SET search_path = 'public';
ALTER FUNCTION public.cleanup_expired_otp() SET search_path = 'public';
ALTER FUNCTION public.create_customer_account(text, text, text, uuid) SET search_path = 'public';
ALTER FUNCTION public.calculate_risk_score(jsonb, jsonb, jsonb) SET search_path = 'public';
ALTER FUNCTION public.encrypt_sensitive_data(jsonb, text) SET search_path = 'public';
ALTER FUNCTION public.log_security_event(text, uuid, text, text, text, jsonb) SET search_path = 'public';
ALTER FUNCTION public.update_security_timestamp() SET search_path = 'public';
ALTER FUNCTION public.verify_customer_otp(text, text, uuid) SET search_path = 'public';
ALTER FUNCTION public.calculate_loyalty_points(numeric, numeric) SET search_path = 'public';
ALTER FUNCTION public.add_loyalty_points(uuid, uuid, integer, text) SET search_path = 'public';
ALTER FUNCTION public.update_customer_tier(uuid) SET search_path = 'public';
ALTER FUNCTION public.validate_coupon(text, uuid, uuid, numeric) SET search_path = 'public';
ALTER FUNCTION public.update_marketing_timestamp() SET search_path = 'public';
ALTER FUNCTION public.log_login_attempt(uuid, inet, text, text, text, jsonb) SET search_path = 'public';
ALTER FUNCTION public.update_updated_at_column() SET search_path = 'public';
ALTER FUNCTION public.process_affiliate_order(text, uuid, jsonb) SET search_path = 'public';
ALTER FUNCTION public.update_user_level() SET search_path = 'public';
ALTER FUNCTION public.update_alliance_member_count() SET search_path = 'public';
ALTER FUNCTION public.create_order_from_cart(uuid, text, text, text, jsonb, uuid) SET search_path = 'public';
ALTER FUNCTION public.update_alliance_stats() SET search_path = 'public';
ALTER FUNCTION public.calculate_weekly_rankings() SET search_path = 'public';
ALTER FUNCTION public.update_tracking_timestamp() SET search_path = 'public';
ALTER FUNCTION public.update_shipment_from_event() SET search_path = 'public';
ALTER FUNCTION public.generate_shipment_tracking_number() SET search_path = 'public';
ALTER FUNCTION public.set_shipment_tracking_number() SET search_path = 'public';
ALTER FUNCTION public.award_chat_points() SET search_path = 'public';
ALTER FUNCTION public.set_updated_at() SET search_path = 'public';